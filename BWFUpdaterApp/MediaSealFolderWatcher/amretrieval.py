import requests
import json
import types
from emailnotifier import sendSuccessEmail
from emailnotifier import sendFailureEmail
	
def testDataForX9X9X9X9X9():
	return '''[{"active":"false","comments":"","completionDate":"2014-12-16 10:43:47","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000557041","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"LawForTombstone_DA000557041_UW044_FTR_Theatrical_2997_4x3FF_133_ENG_NTSC_ProResHQ_60M.mov","fileSize":"46811440","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36520","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144889:158119:DA000557041","requestId":"74203","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:49:52","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000478228","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"LawlessBreedThe_DA000478228_UF820_FTR_Theatrical_2398_16x9SM_133_ENG_HD_ProResHQ_220M.mov","fileSize":"111769916","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36524","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144894:158124:DA000478228","requestId":"74208","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:06:27","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000513729","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"InGodWeTrust_DA000513729_02122_FTR_TheatricalTexted_2398_16x9FF_133_ENG_HD_ProResHQ_220M.mov","fileSize":"131742496","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36525","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144895:158125:DA000513729","requestId":"74209","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:43:10","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000128318","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"InGodWeTrust_DA000128318_02122_FTR_Theatrical_2997_4x3FF_133_LAS_NTSC_ProResHQ_60M.mov","fileSize":"50849586","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36526","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144896:158126:DA000128318","requestId":"74210","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:15:07","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000057907","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"K9_DA000057907_05380_FTR_Theatrical_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"137978864","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36528","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144898:158128:DA000057907","requestId":"74212","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:11:12","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000427688","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"Traffic_DA000427688_09647_FTR_TheatricalTexted_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"197996228","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36529","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144899:158129:DA000427688","requestId":"74213","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:01:32","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000068853","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"DropSquad_DA000068853_05457_FTR_Theatrical_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"115061084","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36532","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144890:158120:DA000068853","requestId":"74204","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"}]'''

def jsonStringForAMNumberTest(amNumber):
	if amNumber == '368139':
		return '''[{"active":"false","comments":"","completionDate":"2014-12-16 10:43:47","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000557041","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"LawForTombstone_DA000557041_UW044_FTR_Theatrical_2997_4x3FF_133_ENG_NTSC_ProResHQ_60M.mov","fileSize":"46811440","filepath":"","folder":"368139","fpdRequestId":"36520","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144889:158119:DA000557041","requestId":"74203","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:41:04","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000062423","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"DropSquad_SET507442_05457_FTR_Theatrical_2997_4x3FF_133_ENGLAS_4CH_NTSC_CC.mpg","fileSize":"35179197","filepath":"","folder":"368139","fpdRequestId":"36521","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144891:158121:DA000062423","requestId":"74205","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:57:17","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000036356","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"HowardTheDuck_05350_FTR_TheatricalDomestic_2398_16X9FF_178_ENG_10CH_HD.mov","fileSize":"139940428","filepath":"","folder":"368139","fpdRequestId":"36522","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144892:158122:DA000036356","requestId":"74206","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:46:57","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000062313","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"HowardTheDuck_SET503742_05350_FTR_Theatrical_2997_4x3FF_133_ENGLAS_4CH_NTSC_CC.mpg","fileSize":"44575822","filepath":"","folder":"368139","fpdRequestId":"36523","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144893:158123:DA000062313","requestId":"74207","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:49:52","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000478228","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"LawlessBreedThe_DA000478228_UF820_FTR_Theatrical_2398_16x9SM_133_ENG_HD_ProResHQ_220M.mov","fileSize":"111769916","filepath":"","folder":"368139","fpdRequestId":"36524","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144894:158124:DA000478228","requestId":"74208","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:06:27","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000513729","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"InGodWeTrust_DA000513729_02122_FTR_TheatricalTexted_2398_16x9FF_133_ENG_HD_ProResHQ_220M.mov","fileSize":"131742496","filepath":"","folder":"368139","fpdRequestId":"36525","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144895:158125:DA000513729","requestId":"74209","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:43:10","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000128318","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"InGodWeTrust_DA000128318_02122_FTR_Theatrical_2997_4x3FF_133_LAS_NTSC_ProResHQ_60M.mov","fileSize":"50849586","filepath":"","folder":"368139","fpdRequestId":"36526","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144896:158126:DA000128318","requestId":"74210","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:43:17","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000023177","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"K9_05380_Feature_4x3FF_NTSC_4Ch_EngLas_CC_DV0434365.mpg","fileSize":"40906300","filepath":"","folder":"368139","fpdRequestId":"36527","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144897:158127:DA000023177","requestId":"74211","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:15:07","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000057907","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"K9_DA000057907_05380_FTR_Theatrical_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"137978864","filepath":"","folder":"368139","fpdRequestId":"36528","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144898:158128:DA000057907","requestId":"74212","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:11:12","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000427688","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"Traffic_DA000427688_09647_FTR_TheatricalTexted_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"197996228","filepath":"","folder":"368139","fpdRequestId":"36529","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144899:158129:DA000427688","requestId":"74213","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:59:12","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000061208","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"GoingBerserk_02151_FTR_Theatrical_2398_16x9FF_178_ENG_4CH_HD.mov","fileSize":"104239024","filepath":"","folder":"368139","fpdRequestId":"36530","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144900:158130:DA000061208","requestId":"74214","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:00:12","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000036375","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"Phantasm2_05371_FTR_Theatrical_2398_16X9FF_178_ENG_8CH_HD.mov","fileSize":"140039920","filepath":"","folder":"368139","fpdRequestId":"36531","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144901:158131:DA000036375","requestId":"74215","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:01:32","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000068853","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"DropSquad_DA000068853_05457_FTR_Theatrical_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"115061084","filepath":"","folder":"368139","fpdRequestId":"36532","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144890:158120:DA000068853","requestId":"74204","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"}]'''
	return None
	
def jsonStringForAMNumber(amNumber):
	if amNumber == 'X9X9X9X9X9':
		return testDataForX9X9X9X9X9()
	try:
		address = 'http://archivemanager.mts.inbcu.com/ArchiveManager/api/requests?folder=' + str(amNumber)
		r = requests.get(address)
		if r.status_code == 200:
			return r.text
	except Exception as e:
		info = 'The server is unable to retrieve data from Archive Manager at %s for the Archive Manager entry %s. This likely means that the number is incorrect or the connection to Archive Manager is faulty.'
		info = info % (address, amNumber)
		sendFailureEmail(info)
	return None

def isAMDataValid(amTextString):
	if amTextString == None:
		return False

	data = json.loads(amTextString)
	
	if type(data) != types.ListType:
		return False
	if len(data) == 0:
		return False	
	for element in data:
		if 'fileName' not in element.keys():
			return False
	return True

def fileNameSizePairsForJSONString(jsonString):
	return fileNameSizePairsForJSONObject(json.loads(jsonString))

def fileNameSizePairsForJSONObject(jsonObject):
	if type(jsonObject) == types.ListType:
		return [{'fileName':x['fileName'], 'fileSize':x['fileSize']} for x in jsonObject]
	elif type(jsonObject) == types.DictType:
		return {'fileName':jsonObject['fileName'], 'fileSize':jsonObject['fileSize']}
	return None

class ArchiveManagerLookUp():

	def __init__(self, numberString):
		self.number = numberString
		try:
			self.metadataObject = json.loads(self.jsonStringForAMNumber(numberString))
			self.isValid = True
		except Exception as e:
			self.isValid = False

	def testDataForX9X9X9X9X9(self):
		return '''[{"active":"false","comments":"","completionDate":"2014-12-16 10:43:47","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000557041","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"LawForTombstone_DA000557041_UW044_FTR_Theatrical_2997_4x3FF_133_ENG_NTSC_ProResHQ_60M.mov","fileSize":"46811440","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36520","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144889:158119:DA000557041","requestId":"74203","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:49:52","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000478228","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"LawlessBreedThe_DA000478228_UF820_FTR_Theatrical_2398_16x9SM_133_ENG_HD_ProResHQ_220M.mov","fileSize":"111769916","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36524","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144894:158124:DA000478228","requestId":"74208","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:06:27","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000513729","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"InGodWeTrust_DA000513729_02122_FTR_TheatricalTexted_2398_16x9FF_133_ENG_HD_ProResHQ_220M.mov","fileSize":"131742496","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36525","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144895:158125:DA000513729","requestId":"74209","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 10:43:10","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000128318","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"InGodWeTrust_DA000128318_02122_FTR_Theatrical_2997_4x3FF_133_LAS_NTSC_ProResHQ_60M.mov","fileSize":"50849586","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36526","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144896:158126:DA000128318","requestId":"74210","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:15:07","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000057907","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"K9_DA000057907_05380_FTR_Theatrical_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"137978864","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36528","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144898:158128:DA000057907","requestId":"74212","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:11:12","createTime":"2014-12-16 10:34:05","daisyBarcode":"DA000427688","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"Traffic_DA000427688_09647_FTR_TheatricalTexted_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"197996228","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36529","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144899:158129:DA000427688","requestId":"74213","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"},{"active":"false","comments":"","completionDate":"2014-12-16 11:01:32","createTime":"2014-12-16 10:34:04","daisyBarcode":"DA000068853","dueDate":"2014-12-16 00:00:00","email":"jeff.yuen@nbcuni.com","errorMessage":"","expedited":"false","fileName":"DropSquad_DA000068853_05457_FTR_Theatrical_2398_16x9FF_178_ENG_HD_ProResHQ_220M.mov","fileSize":"115061084","filepath":"","folder":"X9X9X9X9X9","fpdRequestId":"36532","hidden":"false","jmsRequestor":"USUSHAPLP983","location":"Restore & Deliver","md5checksum":"","poNumber":"157244","priority":"100","progress":"100","referenceId":"144890:158120:DA000068853","requestId":"74204","requestType":"Restore","requestor":"JEFF YUEN","siteId":"Primary","sla":"240","startTime":"2014-12-16 10:34:14","status":"Completed","storageCategory":"ARCHIVE_DR"}]'''

	def jsonStringForAMNumber(self, amNumber):
		if amNumber == 'X9X9X9X9X9':
			return testDataForX9X9X9X9X9()
		if amNumber == '':
			return '[]'

		try:
			address = 'http://archivemanager.mts.inbcu.com/ArchiveManager/api/requests?folder=' + str(amNumber)
			r = requests.get(address)
			if r.status_code == 200:
				return r.text
		except Exception as e:
			info = 'The server is unable to retrieve data from Archive Manager at %s for the Archive Manager entry %s. This likely means that the number is incorrect or the connection to Archive Manager is faulty.'
			info = info % (address, amNumber)
			sendFailureEmail(info)
		return '[]'

	def isAMDataValid(self, amTextString):
		if amTextString == None:
			return False

		data = json.loads(amTextString)
		
		if type(data) != types.ListType:
			return False
		if len(data) == 0:
			return False	
		for element in data:
			if 'fileName' not in element.keys():
				return False
		return True

	def filesInAMJob(self):
		if type(self.metadataObject) == types.ListType:
			return [x['fileName'] for x in self.metadataObject]
		elif type(self.metadataObject) == types.DictType:
			return [self.metadataObject['fileName'],]
		return []	

if __name__ == '__main__':
	print ArchiveManagerLookUp('').filesInAMJob()
	print ArchiveManagerLookUp('369018').filesInAMJob()
	print ArchiveManagerLookUp('360000').filesInAMJob()



	
